<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Step 2 | Sarayu and Alice Weather AI</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Step 2" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Steps after data cleaning" />
<meta property="og:description" content="Steps after data cleaning" />
<link rel="canonical" href="https://sarayu-pr11.github.io/sarayucsa/jupyter/2023/05/30/step2.html" />
<meta property="og:url" content="https://sarayu-pr11.github.io/sarayucsa/jupyter/2023/05/30/step2.html" />
<meta property="og:site_name" content="Sarayu and Alice Weather AI" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-30T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Step 2" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-30T00:00:00-05:00","datePublished":"2023-05-30T00:00:00-05:00","description":"Steps after data cleaning","headline":"Step 2","mainEntityOfPage":{"@type":"WebPage","@id":"https://sarayu-pr11.github.io/sarayucsa/jupyter/2023/05/30/step2.html"},"url":"https://sarayu-pr11.github.io/sarayucsa/jupyter/2023/05/30/step2.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/sarayucsa/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://sarayu-pr11.github.io/sarayucsa/feed.xml" title="Sarayu and Alice Weather AI" /><link rel="shortcut icon" type="image/x-icon" href="/sarayucsa/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/sarayucsa/">Sarayu and Alice Weather AI</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/sarayucsa/_pages/01_homework.html">Homework and Notes</a><a class="page-link" href="/sarayucsa/about/">About Me</a><a class="page-link" href="/sarayucsa/reflection/">Reflection</a><a class="page-link" href="/sarayucsa/_pages/collegeboard.html">College Board Notes</a><a class="page-link" href="/sarayucsa/search/">Search</a><a class="page-link" href="/sarayucsa/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-05-30-step2.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="After-data-cleaning">After data cleaning<a class="anchor-link" href="#After-data-cleaning"> </a></h2><p>This is when you have to start assigning variables and labels to every instance, but before that, we need to make sure every spot has a value, even if it is wrong.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-java"><pre><span></span><span class="n">weather</span> <span class="o">=</span> <span class="n">weather</span><span class="p">.</span><span class="na">ffill</span><span class="p">()</span>
<span class="err">#</span><span class="n">pull</span> <span class="n">the</span> <span class="n">temperature</span> <span class="n">from</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">row</span> <span class="n">and</span> <span class="n">fil</span> <span class="n">it</span> <span class="n">in</span>
<span class="err">#</span><span class="n">in</span> <span class="k">this</span> <span class="k">case</span> <span class="n">the</span> <span class="n">last</span> <span class="n">value</span> 
<span class="err">#</span><span class="n">even</span> <span class="n">though</span> <span class="n">the</span> <span class="n">value</span> <span class="n">is</span> <span class="n">wrong</span><span class="p">,</span> <span class="n">we</span> <span class="n">can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="n">missing</span> <span class="n">values</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we start the predictions. Since we have multiple independent variables in the data (snow, rain, sleet, temperature), the data suffers from multicolinearity. Since this is the case, we need to use ridge regression. This type of model assumes that there is some sort of association between each of the variables and creates a prediction model accordingly.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-java"><pre><span></span><span class="n">from</span> <span class="n">sklearn</span><span class="p">.</span><span class="na">linear_model</span> <span class="kn">import</span> <span class="nn">Ridge</span>

<span class="n">rr</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="err">#</span><span class="n">we</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">going</span> <span class="n">to</span> <span class="n">apply</span> <span class="n">a</span> <span class="n">ridge</span> <span class="n">regression</span> <span class="n">model</span> <span class="n">since</span> <span class="n">the</span> <span class="n">data</span> <span class="n">sufferes</span> <span class="n">from</span> <span class="n">multicolinearity</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-java"><pre><span></span><span class="n">def</span> <span class="nf">backtest</span><span class="p">(</span><span class="n">weather</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">predictors</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">3650</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
    <span class="n">all_predictions</span> <span class="o">=</span> <span class="o">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">weather</span><span class="p">.</span><span class="na">shape</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">train</span> <span class="o">=</span> <span class="n">weather</span><span class="p">.</span><span class="na">iloc</span><span class="o">[</span><span class="p">:</span><span class="n">i</span><span class="p">,:</span><span class="o">]</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">weather</span><span class="p">.</span><span class="na">iloc</span><span class="o">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="n">step</span><span class="p">),:</span><span class="o">]</span>
        
        <span class="n">model</span><span class="p">.</span><span class="na">fit</span><span class="p">(</span><span class="n">train</span><span class="o">[</span><span class="n">predictors</span><span class="o">]</span><span class="p">,</span> <span class="n">train</span><span class="o">[</span><span class="s">&quot;target&quot;</span><span class="o">]</span><span class="p">)</span>
        
        <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="na">predict</span><span class="p">(</span><span class="n">test</span><span class="o">[</span><span class="n">predictors</span><span class="o">]</span><span class="p">)</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="na">Series</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">test</span><span class="p">.</span><span class="na">index</span><span class="p">)</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="o">[</span><span class="n">test</span><span class="o">[</span><span class="s">&quot;target&quot;</span><span class="o">]</span><span class="p">,</span> <span class="n">preds</span><span class="o">]</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">combined</span><span class="p">.</span><span class="na">columns</span> <span class="o">=</span> <span class="o">[</span><span class="s">&quot;actual&quot;</span><span class="p">,</span> <span class="s">&quot;prediction&quot;</span><span class="o">]</span>
        <span class="n">combined</span><span class="o">[</span><span class="s">&quot;diff&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">combined</span><span class="o">[</span><span class="s">&quot;prediction&quot;</span><span class="o">]</span> <span class="o">-</span> <span class="n">combined</span><span class="o">[</span><span class="s">&quot;actual&quot;</span><span class="o">]</span><span class="p">).</span><span class="na">abs</span><span class="p">()</span>
        
        <span class="n">all_predictions</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="n">all_predictions</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This code performs a backtesting analysis using a machine learning model.</p>
<p>Here is a breakdown of what the code does.</p>
<ol>
<li>The function takes four parameters as input: weather (a DataFrame containing weather data), model (a machine learning model object), predictors (a list of predictor variables/columns from the weather DataFrame), start (an optional parameter specifying the starting index for the backtesting, default is 3650), and step (an optional parameter specifying the step size for each iteration of the backtesting, default is 90)</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li><p>It initializes an empty list called all_predictions to store the predictions made during the backtesting.</p>
</li>
<li><p>It starts a for loop that iterates over the range of indices from start to the total number of rows in the weather DataFrame with a step size of step. This loop allows the backtesting to be performed in multiple iterations with overlapping test sets.</p>
</li>
<li><p>Within each iteration of the loop, it splits the weather DataFrame into a training set and a test set. The training set (train) includes all rows from the beginning up to the current index i, while the test set (test) includes the rows from i to i+step.</p>
</li>
<li><p>The machine learning model (model) is trained using the predictor variables (predictors) from the training set (train) and the corresponding target variable (column) named "target" from the training set.</p>
</li>
<li><p>The trained model is then used to make predictions on the predictor variables from the test set (test[predictors]). The predictions are stored in the preds variable.</p>
</li>
<li><p>The predicted values are converted to a pandas Series (preds) with the same index as the test set (test.index).</p>
</li>
<li><p>The actual target values and the predicted values are concatenated together into a DataFrame (combined) using pd.concat(). The columns of the DataFrame are renamed to "actual" and "prediction".</p>
</li>
<li><p>A new column named "diff" is added to the DataFrame combined, which represents the absolute difference between the predicted and actual values.</p>
</li>
<li><p>The DataFrame combined is appended to the all_predictions list.</p>
</li>
<li><p>After the loop completes, all the prediction results from each iteration are concatenated together using pd.concat() and returned as the final result of the function.</p>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In summary, this code performs a backtesting analysis by training a machine learning model on the weather data and making predictions on overlapping test sets. It collects the predicted values, actual values, and the absolute difference between them in each iteration and returns the concatenated result.</p>

</div>
</div>
</div>
</div>



      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/sarayucsa/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://sarayu-pr11.github.io/sarayucsa/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/sarayucsa/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/exampleUser" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/sarayucsa/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/exampleUser" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/sarayucsa/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
